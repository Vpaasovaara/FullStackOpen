(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{46:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(20),s=n.n(a),c=n(9),o=n(2),i=n.n(o),l=n(5),u=n(3),b=n(0),d=function(e){var t=e.blog,n=e.addLike,r=e.deleteBlog;return Object(b.jsxs)("div",{children:[t.title,Object(b.jsx)("br",{}),t.url,Object(b.jsx)("br",{}),"Likes: ",Object(b.jsx)("i",{children:t.likes}),Object(b.jsx)("button",{className:"btn btn-info mx-3",onClick:function(){return n(t.id)},children:"Like"}),Object(b.jsx)("br",{}),Object(b.jsx)("div",{className:"btn btn-danger my-3",onClick:function(){return r(t.id)},children:"Delete blog"})]})},j=function(e){var t=e.blog;return Object(b.jsx)("div",{children:t.title})},m=function(e){var t=e.blog,n=e.addLike,a=e.deleteBlog,s=Object(r.useState)(!1),c=Object(u.a)(s,2),o=c[0],i=c[1];return Object(b.jsxs)("tr",{className:"table-light",children:[Object(b.jsx)("th",{scope:"row",className:"blog",children:o?Object(b.jsx)(d,{blog:t,addLike:n,deleteBlog:a}):Object(b.jsx)(j,{blog:t})}),Object(b.jsx)("td",{children:t.author}),Object(b.jsx)("td",{children:Object(b.jsx)("div",{className:"btn btn-primary",onClick:function(){return i(!o)},children:o?"Hide":"Show"})})]})},p=function(e){return Object(b.jsxs)("form",{className:"container",id:"submitForm",onSubmit:e.addBlog,children:[Object(b.jsxs)("div",{className:"row my-3",children:[e.user.username," logged in"]}),Object(b.jsx)("h2",{className:"row my-3",children:"Add your new blog here"}),Object(b.jsxs)("div",{className:"row my-3",children:[Object(b.jsx)("label",{}),Object(b.jsx)("input",{id:"inputTitle",placeholder:"Title",value:e.title,onChange:function(t){var n=t.target;return e.setTitle(n.value)}})]}),Object(b.jsxs)("div",{className:"row my-3",children:[Object(b.jsx)("label",{}),Object(b.jsx)("input",{id:"urlTitle",placeholder:"Url",value:e.url,onChange:function(t){var n=t.target;return e.setUrl(n.value)}})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsx)("button",{className:"btn btn-primary col",type:"submit",children:"save"}),Object(b.jsx)("div",{className:"col-6"}),Object(b.jsx)("button",{className:"btn btn-danger col",onClick:function(){return e.handleLogout()},children:"Logout"})]})]})},O=function(e){return Object(b.jsxs)("form",{className:"container",onSubmit:e.handleLogin,children:[Object(b.jsxs)("div",{className:"row my-3",children:[Object(b.jsx)("h2",{children:"log in to application"}),Object(b.jsx)("label",{htmlFor:"username"}),Object(b.jsx)("input",{placeholder:"username",id:"username",type:"text",name:"username",value:e.username,onChange:function(t){var n=t.target;return e.setUsername(n.value)},required:!0})]}),Object(b.jsxs)("div",{className:"row my-3",children:[Object(b.jsx)("label",{htmlFor:"password"}),Object(b.jsx)("input",{placeholder:"password",id:"password",type:"password",value:e.password,name:"password",onChange:function(t){var n=t.target;return e.setPassword(n.value)},required:!0})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)("input",{className:"btn btn-primary",type:"submit",name:"login",value:"login"}),Object(b.jsx)("button",{className:"btn btn-danger col mx-3",onClick:function(){return e.setLogInVisible(!1)},children:"Cancel"})]})]})},h=n(6),f=n.n(h),x="/api/users",g=function(){var e=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post(x,t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v={create:g,getAll:function(){return f.a.get(x).then((function(e){return e.data}))}},w=function(e){var t=Object(r.useState)(""),n=Object(u.a)(t,2),a=n[0],s=n[1],c=Object(r.useState)(""),o=Object(u.a)(c,2),d=o[0],j=o[1],m=Object(r.useState)(""),p=Object(u.a)(m,2),O=p[0],h=p[1],f=function(){var t=Object(l.a)(i.a.mark((function t(n){var r,s,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),r={username:d,password:O,name:a},t.prev=2,t.next=5,v.create(r);case 5:return s=t.sent,console.log(s),t.next=9,v.getAll();case 9:c=t.sent,e.setUsers(c),e.setSuccessMessage("added new user: ".concat(d)),e.setCreateVisible(!1),e.setSuccess(!0),setTimeout((function(){e.setSuccess(!1)}),5e3),t.next=22;break;case 17:t.prev=17,t.t0=t.catch(2),e.setErrorMessage("Username already exists"),e.setError(!0),setTimeout((function(){e.setError(!1)}),5e3);case 22:case"end":return t.stop()}}),t,null,[[2,17]])})));return function(e){return t.apply(this,arguments)}}();return Object(b.jsxs)("form",{className:"container",onSubmit:f,children:[Object(b.jsxs)("div",{className:"row my-3",children:[Object(b.jsx)("h2",{children:"Create new user"}),Object(b.jsx)("label",{htmlFor:"name"}),Object(b.jsx)("input",{placeholder:"name",id:"name",type:"text",name:"name",value:a,onChange:function(e){var t=e.target;return s(t.value)},required:!0})]}),Object(b.jsxs)("div",{className:"row my-3",children:[Object(b.jsx)("label",{htmlFor:"username"}),Object(b.jsx)("input",{placeholder:"username",id:"username",type:"text",name:"username",value:d,onChange:function(e){var t=e.target;return j(t.value)},required:!0})]}),Object(b.jsxs)("div",{className:"row my-3",children:[Object(b.jsx)("label",{htmlFor:"password"}),Object(b.jsx)("input",{placeholder:"password",id:"password",type:"password",value:O,name:"password",onChange:function(e){var t=e.target;return h(t.value)},required:!0})]}),Object(b.jsxs)("div",{children:[Object(b.jsx)("input",{className:"btn btn-primary",type:"submit",name:"create",value:"create"}),Object(b.jsx)("button",{className:"btn btn-danger col mx-3",onClick:function(){return e.setCreateVisible(!1)},children:"Cancel"})]})]})},y=function(e){var t=e.setLogInVisible,n=e.setCreateVisible;return Object(b.jsxs)("div",{className:"container my-3",children:[Object(b.jsx)("button",{className:"btn btn-primary",onClick:function(){return t(!0)},children:"Login"}),Object(b.jsx)("button",{className:"btn btn-success mx-3",onClick:function(){return n(!0)},children:"Create account"})]})},k="/api/blogs",N=null,S=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:N}},e.next=3,f.a.post(k,t,n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C={getAll:function(){return f.a.get(k).then((function(e){return e.data}))},create:S,update:function(e,t){return f.a.put("".concat(k,"/").concat(e),t).then((function(e){return e.data}))},setToken:function(e){N="bearer ".concat(e)},destroy:function(e){var t={headers:{Authorization:N}};return f.a.delete("".concat(k,"/").concat(e),t).then((function(e){return e.data}))}},L=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.a.post("".concat("/api/login"),t),e.next=3,n;case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T={login:L},B=function(e){var t=e.error,n=e.message;return Object(b.jsx)("div",{className:"alert alert-danger my-3 ".concat(t?"alert-shown":"alert-hidden"),role:"alert",children:n})},U=function(e){var t=e.success,n=e.message;return Object(b.jsx)("div",{className:"alert alert-success my-3 ".concat(t?"alert-shown":"alert-hidden"),role:"alert",children:n})},I=function(){var e=Object(r.useState)(null),t=Object(u.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(null),o=Object(u.a)(s,2),d=o[0],j=o[1],h=Object(r.useState)([]),f=Object(u.a)(h,2),x=f[0],g=f[1],k=Object(r.useState)(null),N=Object(u.a)(k,2),S=N[0],L=N[1],I=Object(r.useState)([]),A=Object(u.a)(I,2),V=A[0],E=A[1],F=Object(r.useState)(""),q=Object(u.a)(F,2),D=q[0],J=q[1],M=Object(r.useState)(""),z=Object(u.a)(M,2),P=z[0],H=z[1],Y=Object(r.useState)(""),G=Object(u.a)(Y,2),K=G[0],Q=G[1],R=Object(r.useState)(""),W=Object(u.a)(R,2),X=W[0],Z=W[1],$=Object(r.useState)(!1),_=Object(u.a)($,2),ee=_[0],te=_[1],ne=Object(r.useState)(!1),re=Object(u.a)(ne,2),ae=re[0],se=re[1],ce=Object(r.useState)(!1),oe=Object(u.a)(ce,2),ie=oe[0],le=oe[1],ue=Object(r.useState)(!1),be=Object(u.a)(ue,2),de=be[0],je=be[1];Object(r.useEffect)((function(){C.getAll().then((function(e){return g(e)})),v.getAll().then((function(e){return E(e)}))}),[]),Object(r.useEffect)((function(){var e=window.localStorage.getItem("loggedBlogappUser");if(e){var t=JSON.parse(e);L(t),C.setToken(t.token)}}),[]);var me=function(){var e=Object(l.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),console.log("logging in with",D,P),-1!==V.map((function(e){return e.username})).indexOf(D)){e.next=9;break}a("username ".concat(D," doesn't exist")),te(!0),setTimeout((function(){te(!1)}),5e3),e.next=25;break;case 9:return e.prev=9,e.next=12,T.login({username:D,password:P});case 12:n=e.sent,window.localStorage.setItem("loggedBlogappUser",JSON.stringify(n)),C.setToken(n.token),L(n),J(""),H(""),e.next=25;break;case 20:e.prev=20,e.t0=e.catch(9),a("Login failed, wrong username or password"),te(!0),setTimeout((function(){te(!1)}),5e3);case 25:case"end":return e.stop()}}),e,null,[[9,20]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=V.filter((function(e){return e.username===S.username}))[0],console.log(n),r={title:K,author:S.username,url:X,userID:n.id},e.prev=4,e.next=7,C.create(r);case 7:j("added new blog: ".concat(K,", by: ").concat(S.username)),se(!0),setTimeout((function(){se(!1)}),5e3),Q(""),Z(""),window.location.reload(),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(4),a("Failed to add new blog"),te(!0),setTimeout((function(){te(!1)}),5e3);case 20:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.map((function(e){return e.id})).indexOf(t),console.log("index",n),r=Object(c.a)(x)[n],console.log(r),r.likes++,e.next=7,C.update(t,r);case 7:a=e.sent,g(a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(c.a)(x),r=n.filter((function(e){return e.id===t})),console.log("newBlog",r[0]),e.prev=3,!window.confirm("do you want to delete blog ".concat(r[0].title," by ").concat(r[0].author))){e.next=8;break}return e.next=7,C.destroy(t);case 7:window.location.reload();case 8:e.next=15;break;case 10:e.prev=10,e.t0=e.catch(3),a("You are not authorized to delete this blog"),te(!0),setTimeout((function(){te(!1)}),5e3);case 15:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[null===S&&!0===ie?Object(b.jsx)(O,{handleLogin:me,setUsername:J,username:D,setPassword:H,password:P,setLogInVisible:le}):null===S&&!1===ie&&!1===de?Object(b.jsx)(y,{setLogInVisible:le,setCreateVisible:je}):null===S&&!0===de?Object(b.jsx)(w,{setCreateVisible:je,setSuccess:se,setSuccessMessage:j,setError:te,setErrorMessage:a,setUsers:E}):Object(b.jsx)(p,{addBlog:pe,title:K,setTitle:Q,url:X,setUrl:Z,handleLogout:function(){window.localStorage.removeItem("loggedBlogappUser"),window.location.reload()},user:S}),Object(b.jsx)("div",{className:"container",children:ee?Object(b.jsx)(B,{error:ee,message:n}):ae?Object(b.jsx)(U,{success:ae,message:d}):null}),Object(b.jsxs)("div",{className:"container my-3",children:[Object(b.jsx)("h2",{children:"blogs"}),Object(b.jsxs)("table",{className:"table table-striped",children:[Object(b.jsx)("thead",{children:Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"col",children:"Title"}),Object(b.jsx)("th",{scope:"col",children:"Author"}),Object(b.jsx)("th",{scope:"col",children:"Info"})]})}),Object(b.jsx)("tbody",{children:x.map((function(e){return Object(b.jsx)(m,{blog:e,addLike:Oe,deleteBlog:he},e.id)}))})]})]}),Object(b.jsx)("div",{className:"container",children:Object(b.jsx)("button",{onClick:function(){return function(){var e=Object(c.a)(x).sort((function(e,t){return t.likes-e.likes}));console.log(e),g(e)}()},children:"Sort by likes"})})]})};s.a.render(Object(b.jsx)(I,{}),document.getElementById("root"))}},[[46,1,2]]]);
//# sourceMappingURL=main.c4b0884f.chunk.js.map